<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Robot</title>
    <style>
        body{
            margin: 8px;
            background-color: #ccc;
        }
        #mouse{
            width:18px;
            height: 18px;
            background-color: black;
            border-radius: 50%;
            position: absolute;
        }
        #key{
            position: fixed;
            top: 94%;
            left: 40%;
            height: 15px;
        }
        #submitBtn{
            position: fixed;
            top: 94%;
            left: 52%;
        }
    </style>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
        function getMousePos(event) {
            var x,y;
            var e = e||window.event;

            return { x:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-8,
                y:e.clientY+document.body.scrollTop+document.documentElement.scrollTop-8};
        }
        function move(event){
            var i = getMousePos(event);
          //  $("#mouse").css("top",i.y);
           // $("#mouse").css("left",i.x);
           sendMessage(i);
        }
        function MouseClick(event){
            var data;
            if(event.button == 0){
                data = {'mouseClick': '1'};
            } else if(event.button == 2){
                data = {'mouseClick': '3'};
                sendMessage(data);
            }

        }
        function submit(){
            $('#key').val();
        }
        var socket;
        openSocket();
        function openSocket() {
            if(typeof(WebSocket) == "undefined") {
                console.log("您的浏览器不支持WebSocket");
            }else{
                console.log("您的浏览器支持WebSocket");
                //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接
                //var socketUrl="ws://dlz123.cn1.utools.club/webSocket/"+10;
                var socketUrl = "ws://localhost:22599/webSocket/10"
                console.log(socketUrl);
                if(socket!=null){
                    socket.close();
                    socket=null;
                }
                socket = new WebSocket(socketUrl);
                //打开事件
                socket.onopen = function() {
                    console.log("websocket已打开");
                    //socket.send("这是来自客户端的消息" + location.href + new Date());
                };
                //获得消息事件
                socket.onmessage = function(msg) {
                    var serverMsg = "收到服务端信息：" + msg.data;
                    $("#images1")[0].onload = function(e) {
                        window.URL.revokeObjectURL($("#images1")[0].src);
                    };
                    $("#images1")[0].src = window.URL.createObjectURL(msg.data);
                    console.log(serverMsg);
                };
                //关闭事件
                socket.onclose = function() {
                    console.log("websocket已关闭");
                };
                //发生了错误事件
                socket.onerror = function() {
                    console.log("websocket发生了错误");
                }
            }
        }
        // 发消息
        function sendMessage(i) {
            if(typeof(WebSocket) == "undefined") {
                console.log("您的浏览器不支持WebSocket");
            }else {
                // console.log("您的浏览器支持WebSocket");
                socket.send(JSON.stringify(i));
            }
        }

        $(document).ready(function(){
            // 在这里写你的代码...
            $(document).keydown(function(event){
                var e = event || window.event;
                var k = e.keyCode || e.which;
                console.log(k);
                var data ={'key':k};
                socket.send(JSON.stringify(data));
                return false;
            });
        });
        function stop()
        {
            return false;
        }
        document.oncontextmenu=stop;

        function imgClick(){
            console.log('111111');
        }
    </script>
</head>
<body  >
    <img id="images1"  onclick="imgClick()" onmousedown="MouseClick(event)"
         style="width: 1920px;height: 1080px;background-color: #ccc;" align="center"  width="100%" height="100%"
         onmousemove="move(event)"/>
<!--    <div id="mouse"></div>-->
  <!--
   onclick="MouseClick()"
  <input id="key" type="text" placeholder="请输入操作:"/>
    <button id="submitBtn" onclick="submit()">提交</button>-->
</body>
</html>